<!-- customer-login.html -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Customer Login | Harsha Dairyfarm</title>
    <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: url('login-bg.jpg') no-repeat center center fixed;
      background-size: cover;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    .login-box {
      background-color: rgba(255, 255, 255, 0.9);
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 128, 0, 0.3);
      width: 350px;
    }

    h2 {
      text-align: center;
      color: black;
      font-weight: bold;
    }

    input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    button {
      width: 100%;
      padding: 12px;
      background: linear-gradient(to right, #ed5db8, #e4ed2d);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    button:hover {
      background: linear-gradient(to left, #e4ed2d, #0ceb61);
    }

    .error {
      color: red;
      text-align: center;
    }

    .forgot-link {
      display: block;
      text-align: center;
      margin-top: 10px;
      font-size: 14px;
      color: #007bff;
      cursor: pointer;
    }

    .forgot-link:hover {
      text-decoration: underline;
    }
  </style>
</head>

<body>
  <div class="custom-card card-colored">
    <div class="login-box">
      <h2>Login</h2>
      <form id="loginForm">
        <input type="text" id="phone" placeholder="Phone Number" maxlength="10" pattern="\d{10}"
          title="Enter Exactly 10 digits" required />
        <input type="password" id="password" placeholder="Password" required />
        <button type="submit">Login</button>
      </form>
      <p class="error" id="errorMsg"></p>
      <span class="forgot-link" id="forgotPassword">Forgot Password?</span>
      <p style="text-align: center;">Don't have an account? <a href="register.html">Register here</a></p>
    </div>
  </div>

  <script>
    const form = document.getElementById("loginForm");
    const errorMsg = document.getElementById("errorMsg");
    const forgotPassword = document.getElementById("forgotPassword");

    // Login
    form.addEventListener("submit", function (e) {
      e.preventDefault();
      const phone = document.getElementById("phone").value;
      const password = document.getElementById("password").value;
      const users = JSON.parse(localStorage.getItem("customers")) || [];
      const matchedUser = users.find(user => user.phone === phone && user.password === password);

      if (matchedUser) {
        localStorage.setItem("customerLoggedIn", "true");
        localStorage.setItem("customerName", matchedUser.name);
        // If they came from a protected page, go back there
        const redirectPage = localStorage.getItem("redirectAfterLogin") || "./index.html";
        localStorage.removeItem("redirectAfterLogin");
        window.location.href = redirectPage;

        // localStorage.setItem("customerName", matchedUser.name);
        // window.location.href = "customer-order.html";
      } else {
        errorMsg.textContent = "❌ Invalid phone number or password";
      }
    });

    // Forgot password (OTP simulation)
    forgotPassword.addEventListener("click", function () {
      const phoneNumber = prompt("Enter your registered phone number:");
      if (!phoneNumber) {
        alert("Phone number is required!");
        return;
      }

      // Simulate OTP generation
      const otp = Math.floor(100000 + Math.random() * 900000); // 6-digit OTP
      alert(`Your OTP is: ${otp} `);

      // Simulate password reset
      const enteredOtp = prompt("Enter the OTP sent to your phone:");
      if (parseInt(enteredOtp) === otp) {
        const newPassword = prompt("Enter your new password:");
        if (newPassword) {
          let users = JSON.parse(localStorage.getItem("customers")) || [];
          let userIndex = users.findIndex(user => user.phone === phoneNumber);
          if (userIndex !== -1) {
            users[userIndex].password = newPassword;
            localStorage.setItem("customers", JSON.stringify(users));
            alert("✅ Password updated successfully!");
          } else {
            alert("❌ Phone number not found.");
          }
        }
      } else {
        alert("❌ Invalid OTP.");
      }
    });
  </script>

  <script>
  // Example: After login success
  function onLoginSuccess() {
    localStorage.setItem("isLoggedIn", "true"); // store login state
    let redirectPage = localStorage.getItem("redirectAfterLogin") || "./index.html";
    localStorage.removeItem("redirectAfterLogin");
    window.location.href = redirectPage;
  }
</script>
</body>

</html>